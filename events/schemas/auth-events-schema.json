{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dreamscape.io/schemas/auth-events/v1.0",
  "title": "DreamScape Auth Events Schema",
  "description": "JSON Schema for authentication-related Kafka events in the DreamScape platform",
  "definitions": {
    "BaseEvent": {
      "type": "object",
      "required": ["eventId", "eventType", "timestamp", "version", "source", "payload"],
      "properties": {
        "eventId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique event identifier"
        },
        "eventType": {
          "type": "string",
          "description": "Type of the event"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when the event occurred"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+$",
          "description": "Event schema version"
        },
        "source": {
          "type": "string",
          "description": "Source service that published the event"
        },
        "correlationId": {
          "type": "string",
          "format": "uuid",
          "description": "Optional correlation ID for distributed tracing"
        },
        "causationId": {
          "type": "string",
          "format": "uuid",
          "description": "Optional ID of the event that caused this event"
        },
        "metadata": {
          "type": "object",
          "description": "Optional additional metadata"
        },
        "payload": {
          "type": "object",
          "description": "Event-specific payload"
        }
      }
    },
    "AuthLoginPayload": {
      "type": "object",
      "required": ["userId", "sessionId", "ipAddress", "userAgent", "loginAt", "method"],
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique user identifier"
        },
        "sessionId": {
          "type": "string",
          "description": "Session unique identifier"
        },
        "ipAddress": {
          "type": "string",
          "oneOf": [
            {
              "format": "ipv4",
              "description": "IPv4 address"
            },
            {
              "format": "ipv6",
              "description": "IPv6 address"
            }
          ],
          "description": "IP address of the login"
        },
        "userAgent": {
          "type": "string",
          "description": "User agent string"
        },
        "loginAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when login occurred"
        },
        "method": {
          "type": "string",
          "enum": ["password", "oauth", "token"],
          "description": "Authentication method used"
        }
      }
    },
    "AuthLogoutPayload": {
      "type": "object",
      "required": ["userId", "sessionId", "logoutAt"],
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique user identifier"
        },
        "sessionId": {
          "type": "string",
          "description": "Session unique identifier"
        },
        "logoutAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when logout occurred"
        },
        "reason": {
          "type": "string",
          "enum": ["user_initiated", "session_expired", "forced"],
          "description": "Reason for logout"
        }
      }
    },
    "AuthTokenRefreshedPayload": {
      "type": "object",
      "required": ["userId", "sessionId", "refreshedAt", "expiresAt"],
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique user identifier"
        },
        "sessionId": {
          "type": "string",
          "description": "Session unique identifier"
        },
        "refreshedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when token was refreshed"
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when new token expires"
        }
      }
    },
    "AuthPasswordChangedPayload": {
      "type": "object",
      "required": ["userId", "changedAt", "method"],
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique user identifier"
        },
        "changedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when password was changed"
        },
        "method": {
          "type": "string",
          "enum": ["user_initiated", "admin_reset", "forgot_password"],
          "description": "Method used to change password"
        }
      }
    },
    "AuthPasswordResetRequestedPayload": {
      "type": "object",
      "required": ["userId", "email", "requestedAt", "expiresAt", "resetToken"],
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique user identifier"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "User email address"
        },
        "requestedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when reset was requested"
        },
        "expiresAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when reset token expires"
        },
        "resetToken": {
          "type": "string",
          "description": "Password reset token (hashed)"
        }
      }
    },
    "AuthAccountLockedPayload": {
      "type": "object",
      "required": ["userId", "lockedAt", "reason"],
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique user identifier"
        },
        "lockedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when account was locked"
        },
        "reason": {
          "type": "string",
          "enum": ["too_many_attempts", "suspicious_activity", "admin_action"],
          "description": "Reason for account lock"
        },
        "unlockAt": {
          "type": "string",
          "format": "date-time",
          "description": "Optional timestamp when account will be auto-unlocked"
        }
      }
    }
  },
  "oneOf": [
    {
      "title": "Auth Login Event",
      "allOf": [
        {
          "$ref": "#/definitions/BaseEvent"
        },
        {
          "properties": {
            "eventType": {
              "const": "auth.login"
            },
            "payload": {
              "$ref": "#/definitions/AuthLoginPayload"
            }
          }
        }
      ]
    },
    {
      "title": "Auth Logout Event",
      "allOf": [
        {
          "$ref": "#/definitions/BaseEvent"
        },
        {
          "properties": {
            "eventType": {
              "const": "auth.logout"
            },
            "payload": {
              "$ref": "#/definitions/AuthLogoutPayload"
            }
          }
        }
      ]
    },
    {
      "title": "Auth Token Refreshed Event",
      "allOf": [
        {
          "$ref": "#/definitions/BaseEvent"
        },
        {
          "properties": {
            "eventType": {
              "const": "auth.token.refreshed"
            },
            "payload": {
              "$ref": "#/definitions/AuthTokenRefreshedPayload"
            }
          }
        }
      ]
    },
    {
      "title": "Auth Password Changed Event",
      "allOf": [
        {
          "$ref": "#/definitions/BaseEvent"
        },
        {
          "properties": {
            "eventType": {
              "const": "auth.password.changed"
            },
            "payload": {
              "$ref": "#/definitions/AuthPasswordChangedPayload"
            }
          }
        }
      ]
    },
    {
      "title": "Auth Password Reset Requested Event",
      "allOf": [
        {
          "$ref": "#/definitions/BaseEvent"
        },
        {
          "properties": {
            "eventType": {
              "const": "auth.password.reset.requested"
            },
            "payload": {
              "$ref": "#/definitions/AuthPasswordResetRequestedPayload"
            }
          }
        }
      ]
    },
    {
      "title": "Auth Account Locked Event",
      "allOf": [
        {
          "$ref": "#/definitions/BaseEvent"
        },
        {
          "properties": {
            "eventType": {
              "const": "auth.account.locked"
            },
            "payload": {
              "$ref": "#/definitions/AuthAccountLockedPayload"
            }
          }
        }
      ]
    }
  ]
}
